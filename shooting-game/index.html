<!DOCTYPE html>
<html>
  <head>
    <title>Shooting Game</title>
    <script language="javascript" type="text/javascript" src="https://code.createjs.com/createjs-2015.11.26.min.js" ></script>  </head>
  <body onload="init();" >
    <canvas id="gameCanvas" ></canvas>

    <script>
      
      // constants
      var WIDTH = 800; 
      var HEIGHT = 500; 

      // globals
      var image;
      var stage;
      var preload;
      var manifest;
      var queue;
      var score = 0;
      var gameTime = 0; 
      var zombieSpeed = 0;
      var zombiePositionX; 
      var zombiePositionY;

      var zombies = [];



      function init() { 
        var canvas = document.getElementById("gameCanvas"); 
        context = canvas.getContext('2d');
        context.canvas.width = WIDTH;
        context.canvas.height = HEIGHT;
        
        stage = new createjs.Stage("gameCanvas");

        loadAssets()
      }

      function loadAssets() { 
        // set up the loading queue
        queue = new createjs.LoadQueue(false);
        queue.installPlugin(createjs.Sound);
        queue.on("complete", queueLoaded, this);
        createjs.Sound.alternateExtensions = ["ogg"];

        // add assets to the loading queue
        queue.loadManifest([
          {id: 'backgroundImage', src: 'assets/art/background.png'}, 
          {id: 'crossHair', src: 'assets/art/crosshairs/circle-02.png'},
          {id: 'zombie', src: 'assets/art/zombie/1.png'},
          {id: 'backgroundMusic', src: 'assets/sound/Imminent Threat.mp3'}
        ]);
        queue.load();
      }

      function queueLoaded(event) { 

        addAssetsToCanvas();
        stage.update();
      }

      function addAssetsToCanvas() { 

        // add the background
        var backgroundImage = new createjs.Bitmap(queue.getResult("backgroundImage"))
        stage.addChild(backgroundImage); 


        // add crosshair
        var crosshairImage = new createjs.Bitmap(queue.getResult("crossHair"))
        crosshairImage.scaleX=0.3;
        crosshairImage.scaleY=0.3;
        crosshairImage.x = (stage.canvas.width - crosshairImage.image.width * crosshairImage.scaleX) / 2;
        crosshairImage.y = (stage.canvas.height - crosshairImage.image.height * crosshairImage.scaleY) / 2;

        stage.addChild(crosshairImage); 

        // add score
        var scoreText = new createjs.Text("1UP: " + score.toString(), "36px Arial", "#FFF");
        scoreText.x = 10;
        scoreText.y = 10;
        stage.addChild(scoreText);

        // add timer 
        var timerText = new createjs.Text("Time: " + gameTime.toString(), "36px Arial", "#FFF");
        timerText.x = WIDTH - 150;
        timerText.y = 10;
        stage.addChild(timerText);

        // add background music 
        createjs.Sound.play("backgroundMusic", {loop: -1});

        spawnZombies(1);

        // add ticker 
        //createjs.Ticker.setFPS(15);
        createjs.Ticker.addEventListener('tick', stage);
        createjs.Ticker.addEventListener('tick', tickEvent);
      }

      // spuns a zombie in a ramdom location (within the screen)
      function spawnZombies(numberOfZombies) { 

        if (numberOfZombies <= 0) {
          throw ("Need to specify number of zombies"); 
        }
        for (var i = 0; i < numberOfZombies; i++ ) { 
          var newZombie = new Zombie(stage, queue.getResult("zombie")); 
          newZombie.setup(true); 
          newZombie.draw();
          zombies.push(newZombie);
        }
      }

      function tickEvent() { 
        // move the zombie
        for (var i = 0; i < zombies.length; i++) { 
          zombies[i].walk();
        }
      }

      function Zombie (stage, manifestItem) {
        this.x = 0;
        this.y = 0;
        this.scaleX = 1.5;
        this.scaleY = 1.5;
        this.maxSpeedX = 10; 
        this.maxSpeedY = 10;
        this.manifestItem = manifestItem;
        this.stage = stage;
        this.zombieImage;        

        this.setup = function(ramdomStart) { 
          this.zombieImage = new createjs.Bitmap(this.manifestItem);

          if (ramdomStart) { 
            this.x = Math.random() * (this.stage.canvas.width - this.zombieImage.image.width * this.scaleX);
            this.y = Math.random() * (this.stage.canvas.height - this.zombieImage.image.height * this.scaleY);
          }

          var plusOrMinus = Math.random() < 0.5 ? -1 : 1;
          this.maxSpeedX *= plusOrMinus;
          this.maxSpeedY *= plusOrMinus;

        };

        this.draw = function () { 
          this.zombieImage.x = this.x;
          this.zombieImage.y = this.y;
          this.zombieImage.scaleX = this.scaleX;
          this.zombieImage.scaleY = this.scaleY;

          stage.addChild(this.zombieImage); 
        };

        this.outsideStageX = function(positionX) {

          // check left 
          if (positionX < 0) { 
            return true; 
          }
          // check right
          else if ((positionX + this.zombieImage.image.width * this.scaleX) > this.stage.canvas.width) { 
            return true;
          }
          return false;
        };


        this.outsideStageY = function(positionY) {

          if (positionY < 0) { 
            return true;
          }
          else if ((positionY + this.zombieImage.image.height * this.scaleY) > this.stage.canvas.height) { 
            return true;
          }
          return false;
        };

        this.walk = function() {

          var stepX = this.maxSpeedX * Math.random(); 
          var stepY = this.maxSpeedY * Math.random();

          var nextX = this.x + stepX;
          var nextY = this.y + stepY;

          if (this.outsideStageX(nextX)) { 
            // flip the max speed symbol and the step 
            this.maxSpeedX *= (-1);
            nextX = this.x + stepX * (-1);
          }

          if (this.outsideStageY(nextY)) { 
            // flip the max speed symbol and the step
            this.maxSpeedY *= (-1);
            nextY = this.y + stepY * (-1);
          }

          // all good
          this.x = nextX; 
          this.y = nextY;

          this.draw();
        };
      }
     
    </script>
  </body>
</html>